<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<title>Web Cash</title>
	<h:outputStylesheet library="css" name="order.css" />
</h:head>
<h:body>
	<div id="head">
		<ui:insert name="header">
			<ui:include src="/pages/head.xhtml" />
		</ui:insert>
	</div>
	<p:layout id="layout">
		<p:layoutUnit id="layoutLeft" position="west" resizable="true"
			size="500" minSize="40">
			<div class="textOrder">
				<h:outputText id="textOrder" value="ЗАМОВЛЕННЯ" />
			</div>
			<h:form>
				<!-- Button add new suborder in active Order -->
				<p:commandButton value="Нова подача"
					actionListener="#{orderBean.addNewSuborder}" update=":addGood" />
			</h:form>
			<!-- begin table order view -->
			<h:form id="addGood">
			 <p:growl id="messages" showDetail="true"/> 
				<ui:repeat var="suborder" value="#{orderBean.order.suborders}">
					<p:dataTable id="order_table" var="sales" value="#{suborder.sales}">
						<f:facet name="header">
							<p:commandLink value="Подача: #{suborder.index}"
								actionListener="#{orderBean.activeSuborderId}">
								<f:attribute name="selectedSuborder" value="#{suborder}" />
							</p:commandLink>
						</f:facet>
						<p:column width="55%" filterMaxLength="20" headerText="Назва страви"> 
							#{sales.salesGood.name}
            			</p:column>
						<p:column width="10%" headerText="Ціна">  
                			#{sales.salesGood.price}  
            			</p:column>
						<p:column width="20%" headerText="Кількість">
							<p:inplace editor="true">
								<p:keyboard valueChangeListener="#{orderBean.editAmount}" value="#{sales.amount}" required="true"
									label="text" maxlength="6" size="6" layout="custom"  
                					layoutTemplate="123-close,456-clear,789-back,0." onclick="inplace.clear()">
                					<f:attribute name="selectedSale" value="#{sales}" />
                					</p:keyboard>
                					<p:ajax event="save" update=":addGood"/>
							</p:inplace>
						</p:column>
						<p:column width="15%" headerText="Сума">  
                			#{sales.calculatedSum}  
            			</p:column>
						<p:columnGroup type="footer">
							<p:row>
								<p:column colspan="3" footerText="Сума по чеку: "
									style="text-align:right" />
								<p:column footerText="#{suborder.total}" />
							</p:row>
						</p:columnGroup>
					</p:dataTable>
				</ui:repeat>
				<p:toolbar>
					<p:toolbarGroup>
						<h:outputText value="Сума по чеку: #{orderBean.order.total}" styleClass="total"/>
					</p:toolbarGroup>
				</p:toolbar>
			</h:form>
			<!-- end table order view -->
			<p:button value="Зберегти" href="/pages/hall.jsf" />
			<p:button value="Надрукувати" href="/pages/hall.jsf" />
		</p:layoutUnit>
		<p:layoutUnit id="layoutcenter" position="center" size="300">
			<!-- bigin menu view Groups and Goods -->
			<h:form>
				<p:accordionPanel value="#{orderBean.groups}" var="group"
					activeIndex="150">
					<p:tab title="#{group.name}">
						<p:dataGrid value="#{group.goods}" var="good" columns="1">
							<p:column>
								<p:commandButton styleClass="buttonAccordion"
									value="#{good.name} - #{good.price}"
									actionListener="#{orderBean.onClick}" update=":addGood">
									<f:attribute name="selectedGoodName" value="#{good.name}" />
									<f:attribute name="selectedGood" value="#{good}" />
								</p:commandButton>
							</p:column>
						</p:dataGrid>
					</p:tab>
				</p:accordionPanel>
			</h:form>
			<!-- end menu view Groups and Goods -->
		</p:layoutUnit>
	</p:layout>
</h:body>
<div id="order"/>
</html>
