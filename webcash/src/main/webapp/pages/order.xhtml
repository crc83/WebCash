<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<title>#{msgs.order_title}</title>
	<h:outputStylesheet library="css" name="order.css" />
</h:head>
<h:body>
	<div id="head">
		<ui:insert name="header">
			<ui:include src="/pages/head.xhtml" />
		</ui:insert>
	</div>
	<p:layout id="layout">
		<p:layoutUnit id="layoutLeft" position="west" resizable="true"
			size="60%">
			<div class="textOrder">
				<h:outputText value="#{msgs.order_header}" />
				<h:outputText value="#{orderBean.order.dailyId} " />
				<h:outputText value="( #{orderBean.order.table.name} )" />
			</div>
			<h:form>
				<!-- Button add new suborder in active Order -->
				<p:commandButton value="#{msgs.order_new_suborder_btn}"
					actionListener="#{orderBean.addNewSuborder}" update=":addGood" />
			</h:form>
			<!-- begin table order view -->
			<h:form id="addGood">
				<p:growl id="messages" showDetail="true" />
				<ui:repeat var="suborder" value="#{orderBean.order.suborders}">
					<p:dataTable id="order_table" var="sales" value="#{suborder.sales}"
						emptyMessage="">
						<f:facet name="header">
							<p:commandLink value="#{msgs.order_suborder} #{suborder.index}"
								actionListener="#{orderBean.activeSuborderId}">
								<f:attribute name="selectedSuborder" value="#{suborder}" />
							</p:commandLink>
						</f:facet>
						<p:column width="55%" filterMaxLength="20"
							headerText="#{msgs.order_sale_name}"> 
							#{sales.salesGood.name}
            			</p:column>
						<p:column width="10%" headerText="#{msgs.order_sale_price}">  
                			#{sales.salesGood.price}  
            			</p:column>
						<p:column width="20%" headerText="#{msgs.order_sale_amount}">
							<p:inplace editor="true">
								<p:keyboard valueChangeListener="#{orderBean.editAmount}"
									value="#{sales.amount}" required="true" label="text"
									maxlength="6" size="6" layout="custom"
									layoutTemplate="123-close,456-clear,789-back,0."
									onclick="inplace.clear()">
									<f:attribute name="selectedSale" value="#{sales}" />
								</p:keyboard>
								<p:ajax event="save" update=":addGood" />
							</p:inplace>
						</p:column>
						<p:column width="15%" headerText="#{msgs.order_sale_sum}">  
                			#{sales.calculatedSum}  
            			</p:column>
						<p:column>
							<p:commandButton actionListener="#{orderBean.deleteSale}"
								icon="ui-icon-close">
								<f:attribute name="selectedSale" value="#{sales}" />
								<f:ajax event="action" update=":addGood"/>
							</p:commandButton>
						</p:column>
						<p:columnGroup type="footer">
							<p:row>
								<p:column colspan="3" footerText="#{msgs.order_suborder_total}"
									style="text-align:right" />
								<p:column colspan="2" footerText="#{suborder.total}" />
							</p:row>
						</p:columnGroup>
					</p:dataTable>
				</ui:repeat>
				<p:toolbar>
					<p:toolbarGroup>
						<h:outputText
							value="#{msgs.order_order_total} #{orderBean.order.total}"
							styleClass="total" />
					</p:toolbarGroup>
				</p:toolbar>
			<h:form id="form_dialog">
				<p:dialog id="paidDialog" header="#{msgs.order_paid_of_order}"
					widgetVar="paidDialog">
					 <p:selectOneButton valueChangeListener="#{orderBean.choosePaymentOrder}" >  
            			<f:selectItem itemLabel="#{msgs.order_paid_credit_card}" itemValue="payCard" />
            			<f:selectItem itemLabel="#{msgs.order_paid_cash}" itemValue="payCash" />
        			</p:selectOneButton>  
					<h:outputText
						value="#{msgs.order_order_total} #{orderBean.order.total}" />
					<br />
					<h:outputText value="#{msgs.order_input_pay}" />
					<p:inplace editor="true">
						<p:keyboard valueChangeListener="#{orderBean.calculateChange}"
							value="#{orderBean.moneyFromClient}" required="true" label="text"
							maxlength="6" size="6" layout="custom"
							layoutTemplate="123-close,456-clear,789-back,0."
							onclick="inplace.clear()">
						</p:keyboard>
							<p:ajax event="save" update=":addGood:form_dialog:change" />
					</p:inplace>
					<br />
					<h:outputText id="change"
						value="#{msgs.order_output_change} #{orderBean.change}" />
					<br />
					<p:commandButton value="#{msgs.order_btn_pay}"
						actionListener="#{orderBean.payOrder}" />
					<p:commandButton value="#{msgs.order_btn_cancel}"
						onclick="paidDialog.hide();" />
				</p:dialog>
			</h:form>
			</h:form>
			<!-- end table order view -->
			<h:form>
				<p:commandButton value="#{msgs.order_btn_pay}"
					onclick="paidDialog.show();" />
				<p:button value="#{msgs.order_btn_print_bill}" />
				<p:button value="#{msgs.order_btn_print_kitchen}" />
				<p:button value="#{msgs.order_btn_print_discount}" />
				<p:button value="#{msgs.order_btn_close}" href="/pages/hall_use.jsf" />
			</h:form>
		</p:layoutUnit>
		<p:layoutUnit id="layoutcenter" position="center" size="300">
			<!-- begin menu view Groups and Goods -->
			<h:form>
				<p:accordionPanel value="#{orderBean.groups}" var="group"
					activeIndex="150">
					<p:tab title=" #{group.name} ">
						<p:dataGrid value="#{group.goods}" var="good" columns="1">
							<p:column>
								<p:commandButton styleClass="buttonAccordion"
									value=" #{good.name} - #{good.price} "
									actionListener="#{orderBean.addGood}" update=":addGood">
									<f:attribute name="selectedGoodName" value="#{good.name}" />
									<f:attribute name="selectedGood" value="#{good}" />
								</p:commandButton>
							</p:column>
						</p:dataGrid>
					</p:tab>
				</p:accordionPanel>
			</h:form>
			<!-- end menu view Groups and Goods -->
		</p:layoutUnit>
	</p:layout>
</h:body>
<div id="order" />
</html>
